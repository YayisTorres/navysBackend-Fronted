<div class="products-container">
  <!-- Header Section -->
  <header class="page-header">
    <div class="header-wrapper">
      <div class="header-left">
        <button class="back-btn" (click)="goToDashboard()">
          <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
          </svg>
          Volver al Dashboard
        </button>
        <div class="header-info">
          <h1 class="page-title">
            <svg width="28" height="28" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12,2A3,3 0 0,1 15,5V7H20A1,1 0 0,1 21,8V19A2,2 0 0,1 19,21H5A2,2 0 0,1 3,19V8A1,1 0 0,1 4,7H9V5A3,3 0 0,1 12,2M12,4A1,1 0 0,0 11,5V7H13V5A1,1 0 0,0 12,4Z"/>
            </svg>
            Gestión de Productos
          </h1>
          <p class="page-subtitle">{{ totalProducts }} productos en total</p>
        </div>
      </div>
      <div class="header-actions">
        <select
          [(ngModel)]="filters.category"
          (change)="onFilterChange()"
          class="filter-select-header"
        >
          <option value="">Todas las categorías</option>
          <option value="XV vestidos">XV vestidos</option>
          <option value="XV trajes">XV trajes</option>
          <option value="XV accesorios">XV accesorios</option>
          <option value="Bautizo niño">Bautizo niño</option>
          <option value="Bautizo niña">Bautizo niña</option>
          <option value="Bautizo accesorio">Bautizo accesorio</option>
        </select>
        <a routerLink="/products/new" class="action-btn primary">
          <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
            <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
          </svg>
          Nuevo Producto
        </a>
      </div>
    </div>
  </header>

  <!-- Search Section -->
  <section class="search-section">
    <div class="search-wrapper">
      <div class="search-box">
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
          <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
        </svg>
        <input
          type="text"
          [(ngModel)]="filters.search"
          (input)="onFilterChange()"
          placeholder="Buscar productos..."
          class="search-input"
        />
      </div>
      
      <div class="search-controls">
        <div class="items-per-page-control">
          <label for="itemsPerPage" class="items-per-page-label">Mostrar:</label>
          <select
            id="itemsPerPage"
            [(ngModel)]="itemsPerPage"
            (change)="onItemsPerPageChange()"
            class="items-per-page-select"
          >
            <option *ngFor="let option of itemsPerPageOptions" [value]="option">
              {{ option }}
            </option>
          </select>
          <span class="items-per-page-text">por página</span>
        </div>
        
        <button (click)="clearFilters()" class="clear-btn" *ngIf="hasFilters()">
          <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
            <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
          </svg>
          Limpiar filtros
        </button>
      </div>
    </div>
  </section>

  <!-- Loading -->
  <app-loading *ngIf="loading"></app-loading>

  <!-- Products Table -->
  <main class="table-container" *ngIf="!loading && products.length > 0">
    <div class="table-wrapper">
      <!-- Table Header -->
      <div class="table-header">
        <div class="header-cell product-cell">PRODUCTO</div>
        <div class="header-cell info-cell">INFORMACIÓN</div>
        <div class="header-cell category-cell">CATEGORÍA</div>
        <div class="header-cell actions-cell">ACCIONES</div>
      </div>

      <!-- Table Body -->
      <div class="table-body">
        <div *ngFor="let product of products" class="table-row">
          <!-- Product Column -->
          <div class="table-cell product-cell">
            <div class="product-info">
              <div class="product-avatar">
                <img
                  [src]="productService.getFirstProductImage(product)"
                  [alt]="product.name"
                  class="product-image"
                  (error)="onImageError($event)"
                />
              </div>
              <div class="product-details">
                <h3 class="product-name">{{ product.name }}</h3>
                <span class="product-code">{{ product.code }}</span>
                <div class="product-price">${{ product.price }}</div>
              </div>
            </div>
          </div>

          <!-- Information Column -->
          <div class="table-cell info-cell">
            <div class="info-content">
              <div class="info-item" *ngIf="product.description">
                <span class="info-label">Descripción:</span>
                <span class="info-value">{{ truncateText(product.description, 50) }}</span>
              </div>
              <div class="info-item" *ngIf="product.quantity !== undefined">
                <span class="info-label">Stock:</span>
                <span class="info-value">{{ product.quantity }} unidades</span>
              </div>
              <div class="info-item" *ngIf="product.type">
                <span class="info-label">Tipo:</span>
                <span class="info-value">{{ product.type }}</span>
              </div>
            </div>
          </div>

          <!-- Category Column -->
          <div class="table-cell category-cell">
            <span class="category-badge" *ngIf="product.category">
              {{ product.category }}
            </span>
            <span class="category-badge empty" *ngIf="!product.category">
              Sin categoría
            </span>
          </div>

          <!-- Actions Column -->
          <div class="table-cell actions-cell">
            <div class="action-buttons">
              <button
                (click)="viewProduct(product)"
                class="action-btn-small view"
                title="Ver detalles"
              >
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/>
                </svg>
              </button>
              <a
                [routerLink]="['/products/edit', product.id]"
                class="action-btn-small edit"
                title="Editar producto"
              >
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.13,5.12L18.88,8.87M20.71,7.04Z"/>
                </svg>
              </a>
              <button
                (click)="deleteProduct(product)"
                class="action-btn-small delete"
                title="Eliminar producto"
              >
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced Pagination -->
    <div class="table-pagination" *ngIf="totalPages > 1">
      <div class="pagination-info">
        <span>Mostrando {{ getStartItem() }} - {{ getEndItem() }} de {{ totalProducts }} productos</span>
      </div>
      
      <div class="pagination-controls">
        <!-- First Page -->
        <button
          (click)="changePage(1)"
          [disabled]="currentPage <= 1"
          class="page-btn"
          title="Primera página"
        >
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
            <path d="M18.41,16.59L13.82,12L18.41,7.41L17,6L11,12L17,18L18.41,16.59M6,6H8V18H6V6Z"/>
          </svg>
        </button>

        <!-- Previous Page -->
        <button
          (click)="changePage(currentPage - 1)"
          [disabled]="currentPage <= 1"
          class="page-btn"
          title="Página anterior"
        >
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
            <path d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"/>
          </svg>
        </button>

        <!-- Page Numbers -->
        <button
          *ngFor="let page of getPageNumbers()"
          (click)="changePage(page)"
          [class.active]="page === currentPage"
          class="page-number-btn"
        >
          {{ page }}
        </button>

        <!-- Next Page -->
        <button
          (click)="changePage(currentPage + 1)"
          [disabled]="currentPage >= totalPages"
          class="page-btn"
          title="Página siguiente"
        >
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
            <path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"/>
          </svg>
        </button>

        <!-- Last Page -->
        <button
          (click)="changePage(totalPages)"
          [disabled]="currentPage >= totalPages"
          class="page-btn"
          title="Última página"
        >
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
            <path d="M5.59,7.41L10.18,12L5.59,16.59L7,18L13,12L7,6L5.59,7.41M18,6V18H16V6H18Z"/>
          </svg>
        </button>

        <!-- Quick Jump (for many pages) -->
        <select
          *ngIf="totalPages > 10"
          (change)="changePage(+$any($event.target).value)"
          class="page-jump-select"
          title="Saltar a página"
        >
          <option value="">Ir a...</option>
          <option *ngFor="let range of getPageRanges()" [value]="range.page">
            {{ range.label }}
          </option>
        </select>
      </div>
    </div>
  </main>

  <!-- Empty State -->
  <section *ngIf="!loading && products.length === 0" class="empty-section">
    <div class="empty-content">
      <div class="empty-icon">
        <svg width="80" height="80" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12,2A3,3 0 0,1 15,5V7H20A1,1 0 0,1 21,8V19A2,2 0 0,1 19,21H5A2,2 0 0,1 3,19V8A1,1 0 0,1 4,7H9V5A3,3 0 0,1 12,2M12,4A1,1 0 0,0 11,5V7H13V5A1,1 0 0,0 12,4Z"/>
        </svg>
      </div>
      <h3 class="empty-title">No hay productos disponibles</h3>
      <p class="empty-text">
        {{ hasFilters() ? 'No se encontraron productos con los filtros aplicados' : 'Comienza agregando tu primer producto' }}
      </p>
      <a routerLink="/products/new" class="action-btn primary">
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
          <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
        </svg>
        Crear producto
      </a>
    </div>
  </section>

  <!-- Product Detail Modal -->
  <app-product-detail-modal
    [product]="selectedProduct"
    [isVisible]="isModalVisible"
    (close)="closeModal()"
    (edit)="editProductFromModal($event)"
  ></app-product-detail-modal>
</div>